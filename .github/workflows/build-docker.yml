on:
  push:
    branches:
      - docker
jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        arch: [x86_64, x86, aarch64, armv7, ppc64le, s390x]
        include:
          - arch: x86_64
            host: edge
          - arch: x86
            host: edge
          - arch: aarch64
            host: edge
          - arch: armv7
            host: edge
          - arch: ppc64le
            host: edge
            netboot_version: -20210212
          - arch: s390x
            host: edge
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@master
      - run: |
          docker build \
              -t quay.io/ddosolitary/alpine-builder:${{ matrix.arch }} \
              --build-arg ARCH=${{ matrix.arch }} \
              --build-arg ALPINE_HOST=${{ matrix.host }} \
              --build-arg NETBOOT_VERSION=${{ matrix.netboot_version }} .
          docker login \
              -u ddosolitary+alpine_repo_builder \
              -p "${{ secrets.DOCKER_PWD }}" \
              quay.io
          docker push quay.io/ddosolitary/alpine-builder:${{ matrix.arch }}
